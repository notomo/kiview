
call themis#option('recursive', 1)

let s:root = getcwd()

function! KiviewTestBeforeEach() abort
    execute 'cd' s:root
    call s:clear_test_data()
    call s:make_test_data()

    call kiview#logger#set_func({ msg -> themis#log(msg) })
    call themis#log('')
endfunction

function! KiviewTestAfterEach() abort
    silent! %bwipeout!
    execute 'cd' s:root
    call kiview#logger#clear()
    call kiview#input_reader#clear()

    call s:clear_test_data()
endfunction

function! s:make_test_data() abort
    call system(['touch', './test/plugin/_test_data/removed_file1'])
    call system(['touch', './test/plugin/_test_data/removed_file2'])
    call system(['touch', './test/plugin/_test_data/removed_cancel_file'])

    call mkdir('./test/plugin/_test_data/removed_dir', 'p')
    call system(['touch', './test/plugin/_test_data/removed_dir/file'])

    call system(['touch', './test/plugin/_test_data/copy_file'])
    call system(['touch', './test/plugin/_test_data/cut_file'])
    call mkdir('./test/plugin/_test_data/paste', 'p')
endfunction

function! s:clear_test_data() abort
    call delete('./test/plugin/_test_data/removed_dir', 'rf')
    call delete('./test/plugin/_test_data/removed_file1')
    call delete('./test/plugin/_test_data/removed_file2')

    call delete('./test/plugin/_test_data/new', 'rf')
    call delete('./test/plugin/_test_data/removed_cancel_file')

    call delete('./test/plugin/_test_data/copy_file')
    call delete('./test/plugin/_test_data/cut_file')
    call delete('./test/plugin/_test_data/paste', 'rf')
endfunction
